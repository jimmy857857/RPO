<!--pages/accounting/budget.wxml-->
<view class="container">
  <!-- é¢„ç®—æ¦‚è§ˆ -->
  <view class="budget-overview">
    <view class="section-header">
      <text class="section-title">é¢„ç®—æ¦‚è§ˆ</text>
      <text class="section-desc">æœ¬æœˆé¢„ç®—ä½¿ç”¨æƒ…å†µ</text>
    </view>
    
    <view class="budget-stats">
      <view class="stat-item">
        <text class="stat-label">æ€»é¢„ç®—</text>
        <text class="stat-value total">Â¥{{totalBudget}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">å·²ä½¿ç”¨</text>
        <text class="stat-value used">Â¥{{budgetUsed}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">å‰©ä½™</text>
        <text class="stat-value remaining">Â¥{{budgetRemaining}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">ä½¿ç”¨ç‡</text>
        <text class="stat-value rate">{{budgetProgress}}%</text>
      </view>
    </view>
  </view>

  <!-- æ€»é¢„ç®—è®¾ç½® -->
  <view class="total-budget-section">
    <view class="section-header">
      <text class="section-title">æœˆåº¦æ€»é¢„ç®—</text>
      <text class="section-desc">è®¾ç½®æ¯æœˆçš„æ€»æ”¯å‡ºé¢„ç®—</text>
    </view>
    
    <view class="budget-input-section">
      <view class="input-group">
        <text class="input-label">é¢„ç®—é‡‘é¢</text>
        <view class="amount-input">
          <text class="currency-symbol">Â¥</text>
          <input 
            class="amount-field" 
            type="digit" 
            placeholder="0.00" 
            value="{{totalBudget}}"
            bindinput="onTotalBudgetChange"
          />
        </view>
      </view>
      
      <view class="budget-status">
        <text class="status-label">å½“å‰çŠ¶æ€</text>
        <text class="status-value {{budgetStatus}}">
          {{budgetStatusText}}
        </text>
      </view>
    </view>
    
    <view class="budget-progress">
      <view class="progress-info">
        <text class="progress-label">é¢„ç®—ä½¿ç”¨è¿›åº¦</text>
        <text class="progress-value">{{budgetProgress}}%</text>
      </view>
      <view class="progress-bar">
        <view 
          class="progress-fill" 
          style="width: {{budgetProgress}}%"
        ></view>
      </view>
      <view class="progress-detail">
        <text class="detail-text">å·²ç”¨: Â¥{{budgetUsed}}</text>
        <text class="detail-text">å‰©ä½™: Â¥{{budgetRemaining}}</text>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»é¢„ç®—è®¾ç½® -->
  <view class="category-budget-section">
    <view class="section-header">
      <text class="section-title">åˆ†ç±»é¢„ç®—è®¾ç½®</text>
      <text class="section-desc">ä¸ºä¸åŒæ”¯å‡ºç±»åˆ«è®¾ç½®é¢„ç®—</text>
    </view>
    
    <view class="category-list">
      <view 
        class="category-item" 
        wx:for="{{categoryBudgets}}" 
        wx:key="category"
      >
        <view class="category-info">
          <text class="category-icon">{{item.icon}}</text>
          <text class="category-name">{{item.name}}</text>
          <text class="category-amount">Â¥{{item.usedAmount}}/æœˆ</text>
        </view>
        
        <view class="budget-control">
          <input 
            class="budget-input" 
            type="digit" 
            placeholder="0.00" 
            value="{{item.budgetAmount}}"
            data-category="{{item.category}}"
            bindinput="onCategoryBudgetChange"
          />
          <text class="budget-unit">å…ƒ</text>
        </view>
        
        <view class="category-progress">
          <view class="progress-bar-mini">
            <view 
              class="progress-fill-mini" 
              style="width: {{item.progress}}%"
            ></view>
          </view>
          <text class="progress-text">{{item.progress}}%</text>
        </view>
      </view>
    </view>
  </view>

  <!-- é¢„ç®—æé†’è®¾ç½® -->
  <view class="reminder-section">
    <view class="section-header">
      <text class="section-title">é¢„ç®—æé†’</text>
      <text class="section-desc">è®¾ç½®é¢„ç®—è¶…æ”¯æé†’</text>
    </view>
    
    <view class="reminder-list">
      <view class="reminder-item">
        <view class="reminder-info">
          <text class="reminder-title">æ€»é¢„ç®—æé†’</text>
          <text class="reminder-desc">å½“æ€»é¢„ç®—ä½¿ç”¨è¶…è¿‡è®¾å®šé˜ˆå€¼æ—¶æé†’</text>
        </view>
        <switch 
          checked="{{totalReminder.enabled}}" 
          data-type="total"
          bindchange="onReminderToggle"
        />
      </view>
      
      <view class="reminder-item" wx:if="{{totalReminder.enabled}}">
        <view class="reminder-settings">
          <text class="setting-label">æé†’é˜ˆå€¼</text>
          <slider 
            class="threshold-slider" 
            min="50" 
            max="100" 
            step="5" 
            value="{{totalReminder.threshold}}"
            data-type="total"
            bindchange="onThresholdChange"
          />
          <text class="threshold-value">{{totalReminder.threshold}}%</text>
        </view>
      </view>
      
      <view class="reminder-item">
        <view class="reminder-info">
          <text class="reminder-title">åˆ†ç±»é¢„ç®—æé†’</text>
          <text class="reminder-desc">å½“åˆ†ç±»é¢„ç®—ä½¿ç”¨è¶…è¿‡è®¾å®šé˜ˆå€¼æ—¶æé†’</text>
        </view>
        <switch 
          checked="{{categoryReminder.enabled}}" 
          data-type="category"
          bindchange="onReminderToggle"
        />
      </view>
      
      <view class="reminder-item" wx:if="{{categoryReminder.enabled}}">
        <view class="reminder-settings">
          <text class="setting-label">æé†’é˜ˆå€¼</text>
          <slider 
            class="threshold-slider" 
            min="50" 
            max="100" 
            step="5" 
            value="{{categoryReminder.threshold}}"
            data-type="category"
            bindchange="onThresholdChange"
          />
          <text class="threshold-value">{{categoryReminder.threshold}}%</text>
        </view>
      </view>
    </view>
  </view>

  <!-- é¢„ç®—å†å² -->
  <view class="history-section">
    <view class="section-header">
      <text class="section-title">é¢„ç®—å†å²</text>
      <button class="history-btn" bindtap="onViewHistory">æŸ¥çœ‹å…¨éƒ¨</button>
    </view>
    
    <view class="history-list">
      <view 
        class="history-item" 
        wx:for="{{budgetHistory}}" 
        wx:key="month"
      >
        <view class="history-info">
          <text class="history-month">{{item.month}}</text>
          <text class="history-amount">é¢„ç®—: Â¥{{item.budget}}</text>
        </view>
        <view class="history-status">
          <text class="status-text {{item.status}}">{{item.statusText}}</text>
          <text class="status-detail">{{item.used}}/{{item.budget}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-section">
    <button class="action-btn save-btn" bindtap="onSaveBudget">
      <text class="btn-icon">ğŸ’¾</text>
      ä¿å­˜è®¾ç½®
    </button>
    
    <button class="action-btn reset-btn" bindtap="onResetBudget">
      <text class="btn-icon">ğŸ”„</text>
      é‡ç½®é¢„ç®—
    </button>
  </view>
</view>